<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SESEé¯– - å…¬å¼ã‚µã‚¤ãƒˆ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    .fade-in { animation: fadeIn 0.3s ease-in-out; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .hidden { display: none; }
  </style>
</head>
<body class="min-h-screen bg-gray-50 text-gray-800">

  <header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4">
      <div class="flex items-center justify-between py-3">
        <div class="flex items-center gap-3 cursor-pointer" onclick="router('home')">
          <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center text-white font-bold text-sm">
            SE
          </div>
          <div class="font-bold text-lg">SESEé¯–</div>
        </div>

        <nav class="hidden md:flex gap-2">
          <button onclick="router('home')" data-page="home" class="nav-btn px-3 py-2 rounded-lg transition-colors text-gray-600 hover:bg-indigo-50 hover:text-indigo-600">ãƒ›ãƒ¼ãƒ </button>
          <button onclick="router('guidelines')" data-page="guidelines" class="nav-btn px-3 py-2 rounded-lg transition-colors text-gray-600 hover:bg-indigo-50 hover:text-indigo-600">ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³</button>
          <button onclick="router('staff')" data-page="staff" class="nav-btn px-3 py-2 rounded-lg transition-colors text-gray-600 hover:bg-indigo-50 hover:text-indigo-600">é‹å–¶ç´¹ä»‹</button>
          <button onclick="router('serverinfo')" data-page="serverinfo" class="nav-btn px-3 py-2 rounded-lg transition-colors text-gray-600 hover:bg-indigo-50 hover:text-indigo-600">ã‚µãƒ¼ãƒãƒ¼æƒ…å ±</button>
          <button onclick="router('contact')" data-page="contact" class="nav-btn px-3 py-2 rounded-lg transition-colors text-gray-600 hover:bg-indigo-50 hover:text-indigo-600">ãŠå•ã„åˆã‚ã›</button>
          <button id="nav-admin" onclick="router('admin')" class="hidden px-3 py-2 rounded-lg bg-red-50 text-red-600 font-bold hover:bg-red-100 transition-colors">ç®¡ç†ç”»é¢</button>
        </nav>

        <div id="user-area" class="flex items-center gap-3">
          <div class="animate-pulse bg-gray-200 h-8 w-20 rounded"></div>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-7">
    
    <section id="page-home" class="page fade-in">
      <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl p-8 mb-8 shadow-lg">
        <h1 class="text-3xl md:text-4xl font-bold mb-3">SESEé¯–ã¸ã‚ˆã†ã“ã</h1>
        <p class="mb-6 opacity-90">Discordã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚µãƒ¼ãƒãƒ¼ - æ¥½ã—ãã€å®‰å…¨ã«äº¤æµã—ã¾ã—ã‚‡ã†</p>
        <div class="flex gap-3 flex-wrap">
          <a href="https://discord.gg/WEWgXFss9p" target="_blank" rel="noopener noreferrer" class="px-5 py-2.5 bg-white text-indigo-600 rounded-lg font-bold hover:bg-indigo-50 transition shadow flex items-center gap-2">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.048-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/></svg>
            Discordã«å‚åŠ ã™ã‚‹
          </a>
          <button onclick="router('guidelines')" class="px-5 py-2.5 bg-indigo-800 text-white rounded-lg font-bold hover:bg-indigo-900 transition shadow">ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’èª­ã‚€</button>
        </div>
      </div>

      <div class="grid md:grid-cols-3 gap-6 mb-8">
        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
          <div class="text-4xl mb-3">ğŸ›¡ï¸</div>
          <h3 class="font-bold text-lg mb-2">å®‰å…¨ãªã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£</h3>
          <p class="text-gray-600 text-sm">æ˜ç¢ºãªã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã¨é‹å–¶ä½“åˆ¶ã§ã€å®‰å¿ƒã—ã¦äº¤æµã§ãã¾ã™ã€‚</p>
        </div>
        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
          <div class="text-4xl mb-3">ğŸ‘¥</div>
          <h3 class="font-bold text-lg mb-2">æ´»ç™ºãªäº¤æµ</h3>
          <p class="text-gray-600 text-sm">å¤šãã®ãƒ¡ãƒ³ãƒãƒ¼ãŒå‚åŠ ä¸­ã€‚æ§˜ã€…ãªè©±é¡Œã§ç››ã‚Šä¸ŠãŒã‚ã†ã€‚</p>
        </div>
        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
          <div class="text-4xl mb-3">ğŸ’¬</div>
          <h3 class="font-bold text-lg mb-2">å……å®Ÿã—ãŸæ©Ÿèƒ½</h3>
          <p class="text-gray-600 text-sm">å¤šæ•°ã®ãƒãƒ£ãƒ³ãƒãƒ«ã¨BOTæ©Ÿèƒ½ã§å¿«é©ãªDiscordãƒ©ã‚¤ãƒ•ã‚’ã€‚</p>
        </div>
      </div>
    </section>

    <section id="page-guidelines" class="page hidden fade-in">
      <h1 class="text-2xl font-bold mb-6 border-b pb-2">SESEé¯–ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³</h1>
      <div class="bg-white p-6 rounded-xl shadow-sm mb-6 border border-gray-100">
        <h2 class="text-lg font-bold mb-2 text-indigo-700">ğŸ“š ç¬¬ä¸€ç«  - å®šç¾©</h2>
        <p class="text-gray-600"><strong>ç¬¬ä¸€æ¡:</strong> seseã®Discordé¯–ï¼ˆä»¥é™ã€Œã“ã®é¯–ã€ã¨å‘¼ã¶ï¼‰ã§ã®è¦å‰‡ã‚’æŒ‡ã™ã€‚</p>
      </div>
      <div class="bg-white p-6 rounded-xl shadow-sm mb-6 border border-gray-100">
        <h2 class="text-lg font-bold mb-4 text-indigo-700">âš ï¸ ç¬¬äºŒç«  - ç¦æ­¢äº‹é …ã¨ç½°å‰‡</h2>
        <h3 class="font-bold mb-2 border-l-4 border-indigo-500 pl-3">ç¬¬äºŒæ¡ - ç¦æ­¢è¡Œç‚º</h3>
        <ul class="list-disc pl-5 text-gray-600 space-y-1 mb-6">
          <li>ã‚µãƒ–å¢ã‚„botãªã©ã‚’åˆ©ç”¨ã—ã‚µãƒ¼ãƒãƒ¼äººæ•°ã‚’è†¨å¼µã•ã›ã‚‹ã“ã¨</li>
          <li>èª¤ã£ãŸã€ã¾ãŸã¯èª¤è§£ã‚’æ‹›ãæƒ…å ±ã‚’å…±æœ‰ã™ã‚‹ã“ã¨</li>
          <li>ãªã‚Šã™ã¾ã—ã€ä»–è€…ã¸ã®ãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆ</li>
          <li>æš´è¨€ã€ä¾®è¾±ã€äººæ ¼æ”»æ’ƒ</li>
          <li>ã‚¹ãƒ‘ãƒ è¡Œç‚ºï¼ˆé€£æŠ•ã€ç„¡æ„å‘³ãªé•·æ–‡ï¼‰</li>
        </ul>
      </div>
    </section>

    <section id="page-staff" class="page hidden fade-in">
      <h1 class="text-2xl font-bold mb-6 border-b pb-2">é‹å–¶ãƒ¡ãƒ³ãƒãƒ¼ç´¹ä»‹</h1>
      <div class="bg-gradient-to-r from-amber-500 to-orange-500 text-white p-6 rounded-xl mb-6 shadow-md">
        <div class="flex items-center gap-4">
          <div class="text-4xl bg-white bg-opacity-20 p-3 rounded-full">ğŸ‘‘</div>
          <div>
            <h2 class="text-xl font-bold">ã‚ªãƒ¼ãƒŠãƒ¼</h2>
            <div class="mt-1 text-lg font-medium">@sese_PAP_1122</div>
          </div>
        </div>
      </div>
      <div class="grid md:grid-cols-2 gap-6">
        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
          <h2 class="text-lg font-bold mb-4 flex items-center gap-2">ğŸ›¡ï¸ é‹å–¶ï¼ˆã‚¢ãƒ‰ãƒŸãƒ³ï¼‰</h2>
          <div class="space-y-2">
            <div class="p-2 bg-indigo-50 rounded">@creeper_dev</div>
            <div class="p-2 bg-indigo-50 rounded">@MRF_4922</div>
            <div class="p-2 bg-indigo-50 rounded">@7498</div>
          </div>
        </div>
        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
          <h2 class="text-lg font-bold mb-4 flex items-center gap-2">ğŸ‘¥ ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
          <div class="space-y-2">
            <div class="p-2 bg-purple-50 rounded">@kuroneko22_22_sabu</div>
            <div class="p-2 bg-purple-50 rounded">@yshi</div>
            <div class="p-2 bg-purple-50 rounded">@ã‚„ã‚‚</div>
          </div>
        </div>
      </div>
    </section>

    <section id="page-serverinfo" class="page hidden fade-in">
      <h1 class="text-2xl font-bold mb-6 border-b pb-2">ã‚µãƒ¼ãƒãƒ¼æƒ…å ±</h1>
      <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
        <table class="w-full text-left">
          <tr class="border-b"><th class="py-3 text-gray-500">ã‚µãƒ¼ãƒãƒ¼ID</th><td class="py-3">1405840878290993196</td></tr>
          <tr class="border-b"><th class="py-3 text-gray-500">ä½œæˆæ—¥</th><td class="py-3">2024/8/15</td></tr>
          <tr><th class="py-3 text-gray-500">ãƒ¡ãƒ³ãƒãƒ¼æ•°</th><td class="py-3">113äºº</td></tr>
        </table>
      </div>
    </section>

    <section id="page-contact" class="page hidden fade-in">
      <h1 class="text-2xl font-bold mb-6 border-b pb-2">ãŠå•ã„åˆã‚ã› & å±¥æ­´</h1>
      <div id="contact-content" class="max-w-4xl mx-auto">
        <div id="contact-guest" class="hidden bg-white p-8 rounded-xl shadow-sm text-center border">
          <p class="mb-6">ãŠå•ã„åˆã‚ã›ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚</p>
          <a href="/auth/google" class="px-6 py-3 bg-indigo-600 text-white rounded-lg font-bold">Googleã§ãƒ­ã‚°ã‚¤ãƒ³</a>
        </div>
        <div id="contact-user-area" class="hidden space-y-8">
          <form onsubmit="submitContact(event)" class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
            <h2 class="font-bold mb-4">æ–°è¦ãŠå•ã„åˆã‚ã›é€ä¿¡</h2>
            <textarea id="contact-message" rows="4" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none mb-3" placeholder="å†…å®¹ã‚’å…¥åŠ›..." required></textarea>
            <button type="submit" id="submit-btn" class="w-full bg-indigo-600 text-white font-bold py-3 rounded-lg">é€ä¿¡ã™ã‚‹</button>
          </form>
          <div>
            <h2 class="font-bold mb-4">ã‚ãªãŸã®é€ä¿¡å±¥æ­´</h2>
            <div id="my-tickets-list" class="space-y-4"></div>
          </div>
        </div>
      </div>
    </section>

    <section id="page-admin" class="page hidden fade-in">
      <h1 class="text-2xl font-bold mb-6 border-b pb-2 text-red-600">é‹å–¶ç®¡ç†ãƒ‘ãƒãƒ«</h1>
      <div id="admin-tickets-list" class="space-y-6"></div>
    </section>

  </main>

  <footer class="max-w-7xl mx-auto px-4 py-6 text-center text-gray-400 text-sm">
    &copy; 2024 SESE Server.
  </footer>

  <script>
    let currentUser = null;

    // ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
    function router(pageName) {
      document.querySelectorAll('.page').forEach(el => el.classList.add('hidden'));
      const target = document.getElementById(`page-${pageName}`);
      if(target) target.classList.remove('hidden');
      if(pageName === 'contact') loadMyTickets();
      if(pageName === 'admin') loadAdminTickets();
    }

    // ãƒ­ã‚°ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯
    async function checkLogin() {
      try {
        const res = await fetch('/api/user');
        const data = await res.json();
        currentUser = data.isLoggedIn ? data.user : null;
        renderHeader();
        renderContactUI();
      } catch (e) { console.error(e); }
    }

    function renderHeader() {
      const area = document.getElementById('user-area');
      const adminBtn = document.getElementById('nav-admin');
      if(currentUser) {
        area.innerHTML = `<span class="text-sm font-bold">${currentUser.name}</span><a href="/logout" class="text-xs text-red-500 border border-red-200 px-2 py-1 rounded">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>`;
        if(currentUser.isAdmin) adminBtn.classList.remove('hidden');
      } else {
        area.innerHTML = `<a href="/auth/google" class="px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-bold">ãƒ­ã‚°ã‚¤ãƒ³</a>`;
      }
    }

    function renderContactUI() {
      const guest = document.getElementById('contact-guest');
      const userArea = document.getElementById('contact-user-area');
      if(currentUser) {
        guest.classList.add('hidden');
        userArea.classList.remove('hidden');
      } else {
        guest.classList.remove('hidden');
        userArea.classList.add('hidden');
      }
    }

    // ãŠå•ã„åˆã‚ã›é€ä¿¡
    async function submitContact(e) {
      e.preventDefault();
      const message = document.getElementById('contact-message').value;
      const res = await fetch('/api/contact', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ message })
      });
      if(res.ok) {
        alert("é€ä¿¡ã—ã¾ã—ãŸï¼");
        document.getElementById('contact-message').value = '';
        loadMyTickets();
      }
    }

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¥æ­´èª­ã¿è¾¼ã¿
    async function loadMyTickets() {
      const list = document.getElementById('my-tickets-list');
      const res = await fetch('/api/my-contacts');
      const data = await res.json();
      list.innerHTML = data.length ? data.map(t => `
        <div class="bg-white p-4 rounded-lg shadow-sm border">
          <div class="text-xs text-gray-400 mb-2">${new Date(t.createdAt).toLocaleString()}</div>
          <p class="text-sm mb-3">${t.message}</p>
          ${t.reply ? `<div class="p-3 bg-green-50 border-l-4 border-green-500 text-sm"><strong>é‹å–¶ã®è¿”ä¿¡:</strong><br>${t.reply}</div>` : '<span class="text-xs bg-amber-100 text-amber-700 px-2 py-1 rounded">å›ç­”å¾…ã¡</span>'}
        </div>
      `).join('') : '<p class="text-gray-400">å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
    }

    // ç®¡ç†ç”»é¢èª­ã¿è¾¼ã¿
    async function loadAdminTickets() {
      const list = document.getElementById('admin-tickets-list');
      const res = await fetch('/api/admin/contacts');
      const data = await res.json();
      list.innerHTML = data.map(t => `
        <div class="bg-white p-5 rounded-xl shadow border border-red-100">
          <div class="flex items-center gap-3 mb-3 text-sm">
            <img src="${t.userPhoto}" class="w-8 h-8 rounded-full">
            <strong>${t.userName}</strong> <span class="text-gray-400 text-xs">${t.userEmail}</span>
          </div>
          <p class="bg-gray-50 p-3 rounded text-sm mb-4">${t.message}</p>
          <textarea id="reply-${t.id}" class="w-full p-2 border rounded text-sm mb-2" placeholder="è¿”ä¿¡å†…å®¹...">${t.reply || ''}</textarea>
          <button onclick="saveReply('${t.id}')" class="bg-green-600 text-white text-xs px-4 py-2 rounded">è¿”ä¿¡ã‚’ä¿å­˜</button>
        </div>
      `).join('');
    }

    async function saveReply(id) {
      const reply = document.getElementById(`reply-${id}`).value;
      await fetch(`/api/admin/reply/${id}`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ reply })
      });
      alert("ä¿å­˜ã—ã¾ã—ãŸã€‚");
    }

    window.addEventListener('DOMContentLoaded', () => { checkLogin(); router('home'); });
  </script>
</body>
</html>
